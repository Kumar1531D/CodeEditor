<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Code Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs/loader.js"></script>
    <script src="editor.js" defer></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; text-align: center; }
        #container { width: 80%; height: 400px; margin: 20px auto; border: 1px solid #ccc; }
        button { padding: 10px; margin-top: 10px; cursor: pointer; }
        #sync-info { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Real-Time Code Editor</h1>
    <div id="container"></div>
    <button id="sync-button">Sync Code</button>
    <p id="sync-info">Last sync by: None</p>

    <script>
 // JavaScript (Frontend)
    let editor;
    let socket;
    let username = sessionStorage.getItem("username");

    require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.0/min/vs' } });

    require(['vs/editor/editor.main'], function () {
        editor = monaco.editor.create(document.getElementById('container'), {
            value: "public class Main {\n    public static void main(String[] args) {\n        System.out.println(\"Hello, World!\");\n    }\n}",
            language: 'java',
            theme: 'vs-dark',
            automaticLayout: true
        });

        socket = new WebSocket("ws://localhost:8002/CodeEditorDemo/codeEditor");

        socket.onopen = function () {
            console.log("‚úÖ WebSocket Connected!");
        };

        socket.onerror = function (error) {
            console.error("‚ùå WebSocket Error: ", error);
        };

        socket.onclose = function () {
            console.log("üî¥ WebSocket Disconnected.");
        };

        document.getElementById("sync-button").addEventListener("click", function () {
            if (socket.readyState === WebSocket.OPEN) {
                let code = editor.getValue();
                let payload = JSON.stringify({ user: username, code: code });
                console.log("üîπ Sending Code Update:", payload);
                document.getElementById('sync-info').innerText = `Last sync by: ${username}`;
                socket.send(payload);
            } else {
                console.warn("‚ö†Ô∏è WebSocket not open!");
            }
        });

        socket.onmessage = function (event) {
            let data = JSON.parse(event.data);
            console.log("üì© Server Response:", data);
            document.getElementById('sync-info').innerText = `Last sync by: ${data.user}`;
            editor.setValue(data.code);
        };
    });

    </script>

</body>
</html>
